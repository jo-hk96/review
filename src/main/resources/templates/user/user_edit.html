<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" 
                  xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <title>ìœ ì € ì •ë³´ ìˆ˜ì •</title>
    <link rel="stylesheet" href="/css/user_mypage.css">
    <link rel="stylesheet" href="/css/footer.css">
   	<link rel="stylesheet" href="/css/user_edit.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%2210 0 100 100%22><text y=%22.90em%22 font-size=%2290%22>ğŸ¬</text></svg>">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
</head>
<body>
<button class="menu-btn" onclick="toggleMenu()">ë©”ë‰´</button>

<div id="menu-list">
	<!-- í™ˆ ë°”ë¡œê°€ê¸° ë²„íŠ¼ -->
		<form action="/" method="get" style="margin-bottom:10px;">
		  	<button type="submit" class="home-btn">í™ˆ ë°”ë¡œê°€ê¸°</button>
		 </form>
	   <!-- íƒˆí‡´ ë²„íŠ¼ -->
	  <form th:action="@{/UserDelete}" method="post">
	    <button type="submit" onclick="return confirm('ì •ë§ íƒˆí‡´ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')">íšŒì› íƒˆí‡´</button>
	  </form>
</div>
<script>
function toggleMenu() {
    const menu = document.getElementById('menu-list');
    if (menu.style.display === 'none' || menu.style.display === '') {
        menu.style.display = 'block';
    } else {
        menu.style.display = 'none';
    }
}
</script>

</body>
<body>
    <div class="user-edit-container">
        <h1>ë‚´ ì •ë³´ ìˆ˜ì •</h1>
        
        
        <!-- ì˜ˆì™¸ ë©”ì‹œì§€ ì¶œë ¥ ì˜ì—­ -->
        
        <form action="/UserEdit" method="post" class="user-edit-form">
            <div class="form-group">
                <label for="email">ì´ë©”ì¼</label>
                <input type="email" id="email" name="email" th:value="${#authentication.principal.username}" readonly="readonly">
            </div>
            <div class="form-group">
                <label for="nickname">ë³€ê²½í•  ë‹‰ë„¤ì„</label>
                <input type="text" id="nickname" name="nickname" th:value="${#authentication.principal.nickname}">
            </div>
            <div class="form-group">
  	 		  <label for="birthdate">ìƒë…„ì›”ì¼</label>
  			  <input type="date" id="birthdate" name="birthdate" th:value="${#authentication.principal.birthdate}">
			</div>
            <div class="form-group">
                <label for="currentPassword">í˜„ì¬ ë¹„ë°€ë²ˆí˜¸</label>
                <input type="password" id="currentPassword" name="currentPassword">
                <div th:if="${errorMessage}" class="alert" th:text="${errorMessage}"></div>
            </div>
            <div class="form-group">
                <label for="newPassword">ìˆ˜ì • ë¹„ë°€ë²ˆí˜¸</label>
                <input type="password" id="newPassword" name="newPassword">
            </div>
            <div class="form-group">
                <label for="confirmNewPassword">ë¹„ë°€ë²ˆí˜¸ í™•ì¸</label>
                <input type="password" id="confirmNewPassword" name="confirmNewPassword">
                <p id="passwordMismatchError" class="error-message"></p>
            </div>
            <button type="submit" class="submit-button">ìˆ˜ì •</button>
        </form>
    </div>
    <div th:insert="index/index :: footer"></div>
    
    
    
    
    <script>
    document.querySelector('.user-edit-form').addEventListener('submit', function(event) {
        // í¼ ì œì¶œì˜ ê¸°ë³¸ ë™ì‘(í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨)ì„ ë§‰ìŠµë‹ˆë‹¤.
        event.preventDefault();

        // ì…ë ¥ í•„ë“œì˜ ê°’ì„ ê°€ì ¸ì˜µë‹ˆë‹¤.
        const currentPassword = document.getElementById('currentPassword').value;
        const newPassword = document.getElementById('newPassword').value;
        const confirmNewPassword = document.getElementById('confirmNewPassword').value;
        const errorMessageDiv = document.getElementById('passwordMismatchError');

        // ì´ì „ ì˜¤ë¥˜ ë©”ì‹œì§€ë¥¼ ì´ˆê¸°í™”í•©ë‹ˆë‹¤.
        errorMessageDiv.textContent = '';
        errorMessageDiv.style.color = 'red';

        // ì‚¬ìš©ìê°€ ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ì„ ì‹œë„í–ˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.
        // newPassword ë˜ëŠ” confirmNewPasswordê°€ ë¹„ì–´ìˆì§€ ì•Šìœ¼ë©´ ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ì‹œë„ë¡œ ê°„ì£¼í•©ë‹ˆë‹¤.
        const isPasswordChangeAttempt = newPassword !== '' || confirmNewPassword !== '';

        if (isPasswordChangeAttempt) {
            // ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ì„ ì‹œë„í–ˆë‹¤ë©´, í˜„ì¬ ë¹„ë°€ë²ˆí˜¸ê°€ ë°˜ë“œì‹œ ì…ë ¥ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.
            if (currentPassword === '') {
                errorMessageDiv.textContent = 'ë¹„ë°€ë²ˆí˜¸ë¥¼ ë³€ê²½í•˜ë ¤ë©´ í˜„ì¬ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì•¼ í•©ë‹ˆë‹¤.';
                return; // í¼ ì œì¶œì„ ì¤‘ë‹¨í•©ë‹ˆë‹¤.
            }
            
            // ìƒˆ ë¹„ë°€ë²ˆí˜¸ì™€ ë¹„ë°€ë²ˆí˜¸ í™•ì¸ì´ ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.
            if (newPassword !== confirmNewPassword) {
                errorMessageDiv.textContent = 'ë¹„ë°€ë²ˆí˜¸ì™€ ë¹„ë°€ë²ˆí˜¸ í™•ì¸ì´ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.';
                return; // í¼ ì œì¶œì„ ì¤‘ë‹¨í•©ë‹ˆë‹¤.
            }
        }
        // ìœ„ì˜ ëª¨ë“  í´ë¼ì´ì–¸íŠ¸ ì¸¡ ê²€ì¦ì„ í†µê³¼í–ˆë‹¤ë©´, í¼ì„ ì„œë²„ë¡œ ì œì¶œí•©ë‹ˆë‹¤.
        // ë‹‰ë„¤ì„ë§Œ ë³€ê²½í•˜ëŠ” ê²½ìš°ì—ë„ ì´ ë¶€ë¶„ì—ì„œ ì œì¶œë©ë‹ˆë‹¤.
        this.submit();
    });
</script>
</body>
</html>